<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<!-- iOS Safari -->
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<!-- Chrome, Firefox OS and Opera Status Bar Color -->
<meta name="theme-color" content="#FFFFFF">
<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css">
<link rel="stylesheet" type="text/css"
  href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.19.0/themes/prism.min.css">
<link rel="stylesheet" type="text/css" href="css/SourceSansPro.css">
<link rel="stylesheet" type="text/css" href="css/theme.css">
<link rel="stylesheet" type="text/css" href="css/notablog.css">
<!-- Favicon -->

  <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22&gt;&lt;text text-anchor=%22middle%22 dominant-baseline=%22middle%22 x=%2250%22 y=%2255%22 font-size=%2280%22&gt;♾️&lt;/text&gt;&lt;/svg&gt;">

<style>
  :root {
    font-size: 20px;
  }
</style>
  <title>ØMQ&nbsp;|&nbsp;humblog</title>
  <meta property="og:type" content="blog">
  <meta property="og:title" content="ØMQ">
  
    <meta name="description" content="ZeroMQ概述，探讨了 ROUTER-ROUTER 模式">
    <meta property="og:description" content="ZeroMQ概述，探讨了 ROUTER-ROUTER 模式">
  
  
    <meta property="og:image" content="data:image/svg+xml,&lt;svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22&gt;&lt;text text-anchor=%22middle%22 dominant-baseline=%22middle%22 x=%2250%22 y=%2255%22 font-size=%2280%22&gt;✔️&lt;/text&gt;&lt;/svg&gt;">
  
  <style>
    .DateTagBar {
      margin-top: 1.0rem;
    }
  </style>
</head>

<body>
  <nav class="Navbar">
  <a href="index.html">
    <div class="Navbar__Btn">
      
        <span><img class="inline-img-icon" src="data:image/svg+xml,&lt;svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22&gt;&lt;text text-anchor=%22middle%22 dominant-baseline=%22middle%22 x=%2250%22 y=%2255%22 font-size=%2280%22&gt;♾️&lt;/text&gt;&lt;/svg&gt;"></span>&nbsp;
      
      <span>Home</span>
    </div>
  </a>
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <span class="Navbar__Delim">&centerdot;</span>
      <a href="about.html">
        <div class="Navbar__Btn">
          
            <span><img class="inline-img-icon" src="data:image/svg+xml,&lt;svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22&gt;&lt;text text-anchor=%22middle%22 dominant-baseline=%22middle%22 x=%2250%22 y=%2255%22 font-size=%2280%22&gt;🌖&lt;/text&gt;&lt;/svg&gt;"></span>&nbsp;
          
          <span>About</span>
        </div>
      </a>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
</nav>
  <header class="Header">
    
    <div class="Header__Spacer Header__Spacer--NoCover">
    </div>
    
      <div class="Header__Icon">
        <span><img class="inline-img-icon" src="data:image/svg+xml,&lt;svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22&gt;&lt;text text-anchor=%22middle%22 dominant-baseline=%22middle%22 x=%2250%22 y=%2255%22 font-size=%2280%22&gt;✔️&lt;/text&gt;&lt;/svg&gt;"></span>
      </div>
    
    <h1 class="Header__Title">ØMQ</h1>
    
  </header>
  <article id="https://www.notion.so/1707063b7c0a45729526f7db2f7bbc49" class="PageRoot"><blockquote id="https://www.notion.so/7f20206f5d8641a2857f10e31ab39f92" class="ColorfulBlock ColorfulBlock--ColorDefault Quote"><span class="SemanticStringArray"><span class="SemanticString">ZeroMQ is an </span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">asynchronous</strong></span><span class="SemanticString"> messaging library, aimed at use in distributed or concurrent applications. It provides a message queue, but unlike message-oriented middleware, a ZeroMQ system can run without a dedicated message broker; the zero in the name is for zero broker.</span></span></blockquote><h3 id="https://www.notion.so/8c923352424f45e9ac2ef66edf2fd570" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/8c923352424f45e9ac2ef66edf2fd570"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">为什么需要ZeroMQ</span></span></h3><div id="https://www.notion.so/965ad65792184db59b57a32fe38429d0" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">简单，可拓展性。帮助开发者专注于消息的传递和网络拓扑的设计，而不是连接的建立或可用性的保证。（支持自动重连）</span></span></p></div><div id="https://www.notion.so/e9b6b76349b14338b2da3c4c2e52e4a9" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="https://zguide.zeromq.org/docs/chapter1/#Why-We-Needed-ZeroMQ">https://zguide.zeromq.org/docs/chapter1/#Why-We-Needed-ZeroMQ</a></span></span></p></div><h3 id="https://www.notion.so/078c0c2b98cc4a5eadecfb4ecfce232f" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/078c0c2b98cc4a5eadecfb4ecfce232f"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">ZeroMQ的通信哲学</span></span></h3><blockquote id="https://www.notion.so/11ba5dfa9d434b23b4c92254f13c079a" class="ColorfulBlock ColorfulBlock--ColorDefault Quote"><span class="SemanticStringArray"><span class="SemanticString">To fix the world, we needed to do two things. One, to solve the general problem of “how to connect any code to any code, anywhere”. Two, to wrap that up in the simplest possible building blocks that people could understand and use </span><span class="SemanticString"><em class="SemanticString__Fragment SemanticString__Fragment--Italic">easily</em></span><span class="SemanticString">.</span></span></blockquote><div id="https://www.notion.so/068952d435ef47b8b2e924068a31d447" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">namely, 用最简单的方式建立连接，另外，在使用zmq进行通信开发时，你需要忘记掉所有有关tcp的知识，因为zmq包装了所有的连接，在套接字之上又抽象包装了一层，因此部分概念会与常规的计算机网络概念相悖。</span></span></p></div><h3 id="https://www.notion.so/3c0e7c5f982544aa9980a84ac7c37d84" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/3c0e7c5f982544aa9980a84ac7c37d84"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">ZeroMQ的通信特点</span></span></h3><ol class="NumberedListWrapper"><li id="https://www.notion.so/0b05aeddc09349539ad51a16372c13ea" class="NumberedList" value="1"><span class="SemanticStringArray"><span class="SemanticString">ZeroMQ doesn’t know anything about the data you send except its size in bytes.</span></span><div id="https://www.notion.so/a4158ddd25bd4c818fb2ce2a67ddea4d" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">也就是说，如同 c 这样的以 null 结尾字符串的方式需要进行额外的处理。</span></span></p></div><div id="https://www.notion.so/c2a0f1d1ae2344cf84ddb7211bd96068" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">同时，这也意味着从二进制到解析结果这部分需要用户自己进行处理。（尽管现在的zmq已经提供了常用的解码方式）</span></span></p></div></li><li id="https://www.notion.so/b4bce15996c740e7b1ed27fc50e6abd6" class="NumberedList" value="2"><span class="SemanticStringArray"><span class="SemanticString">In theory with ZeroMQ sockets, it does not matter which end connects and which end binds. However, in practice there are undocumented differences that I’ll come to later.</span></span><div id="https://www.notion.so/810e4cc037f4432aa250e5e0d8d421f5" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">理论求自由，实践不逾矩</span></span></p></div></li></ol><h3 id="https://www.notion.so/86c133dcf0424e27be92d69c7f4e5227" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/86c133dcf0424e27be92d69c7f4e5227"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Basic</span></span></h3><ol class="NumberedListWrapper"><li id="https://www.notion.so/93ce1928c6ab41ca86773109ebd8e6fd" class="NumberedList" value="1"><span class="SemanticStringArray"><span class="SemanticString">连接就是连接，连接建立一个结构，不要考虑其他的</span></span><blockquote id="https://www.notion.so/80bf6a13b58f42adbe2f6122ea793378" class="ColorfulBlock ColorfulBlock--ColorDefault Quote"><span class="SemanticStringArray"><span class="SemanticString">Now, imagine we start the client </span><span class="SemanticString"><em class="SemanticString__Fragment SemanticString__Fragment--Italic">before</em></span><span class="SemanticString"> we start the server. In traditional networking, we get a big red Fail flag. But ZeroMQ lets us start and stop pieces arbitrarily. As soon as the client node does </span><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="http://api.zeromq.org/master:zmq_connect">zmq_connect()</a></span><span class="SemanticString">, the connection exists and that node can start to write messages to the socket. At some stage (hopefully before messages queue up so much that they start to get discarded, or the client blocks), the server comes alive, does a </span><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="http://api.zeromq.org/master:zmq_bind">zmq_bind()</a></span><span class="SemanticString">, and ZeroMQ starts to deliver messages.</span></span></blockquote></li><li id="https://www.notion.so/49de7b180c9e4f1ba9a95359f24c7741" class="NumberedList" value="2"><span class="SemanticStringArray"><span class="SemanticString">服务节点可以绑定多个端点</span></span><div id="https://www.notion.so/b22bd4272e39487ca0f80260e24084e3" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">如果不理解，请重读</span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">ZeroMQ的通信哲学</strong></span><span class="SemanticString">小节</span></span></p></div><pre id="https://www.notion.so/c7895ae325f2496a97e6bec493b21e4d" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>zmq_bind <span class="token punctuation">(</span>socket<span class="token punctuation">,</span> <span class="token string">"tcp://*:5555"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
zmq_bind <span class="token punctuation">(</span>socket<span class="token punctuation">,</span> <span class="token string">"tcp://*:9999"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
zmq_bind <span class="token punctuation">(</span>socket<span class="token punctuation">,</span> <span class="token string">"inproc://somename"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></span></span></code></pre></li><li id="https://www.notion.so/d7a37bc514854aea8321017b39322eba" class="NumberedList" value="3"><span class="SemanticStringArray"><span class="SemanticString">合法的组合</span></span><ul class="BulletedListWrapper"><li id="https://www.notion.so/5b4b1819f3ad4c91af3b2b589572ff2f" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">PUB and SUB</span></span></li><li id="https://www.notion.so/273d14fd81c449fdbbb1f67985daf897" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">REQ and REP</span></span></li><li id="https://www.notion.so/abb889cf0b704c58874a71c0fefac79f" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">REQ and ROUTER (take care, REQ inserts an extra null frame)</span></span></li><li id="https://www.notion.so/f1391efe28a842e3a398962da954083e" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">DEALER and REP (take care, REP assumes a null frame)</span></span></li><li id="https://www.notion.so/75111aa5a394415a9156866e12c52d09" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">DEALER and ROUTER</span></span></li><li id="https://www.notion.so/c1350c3b60ae4a56b6aea14f01fb5c9d" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">DEALER and DEALER</span></span></li><li id="https://www.notion.so/311dd86aa6a64ae18ca6108998da3581" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">ROUTER and ROUTER</span></span></li><li id="https://www.notion.so/942c7570d9684db093a416a660a9d8fa" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">PUSH and PULL</span></span></li><li id="https://www.notion.so/78eb6cd88c9a45d9b5a1303c7614eded" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">PAIR and PAIR</span></span></li></ul></li></ol><h3 id="https://www.notion.so/7f9c1fd9fac64bac90312fc65c475090" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/7f9c1fd9fac64bac90312fc65c475090"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">头疼msg，理解msg，维护msg</span></span></h3><ol class="NumberedListWrapper"><li id="https://www.notion.so/46547efecee7465fa43c2e7fd033628a" class="NumberedList" value="1"><span class="SemanticStringArray"><span class="SemanticString">帧是zmq通信的基本传输格式（basic wire format）</span></span><div id="https://www.notion.so/01c20369a2474ab7af2934293b084fc3" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Frames (also called “message parts” in the ZeroMQ reference manual pages) are the basic wire format for ZeroMQ messages. A frame is a </span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">length-specified block of data</strong></span><span class="SemanticString">. The length can be zero upwards. If you’ve done any TCP programming you’ll appreciate why frames are a useful answer to the question “how much data am I supposed to read of this network socket now?”</span></span></p></div></li><li id="https://www.notion.so/d8ca0f11db3346338cd0f901efe47dd8" class="NumberedList" value="2"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">从概念来说，ZeroMQ 消息是一个帧</strong></span><span class="SemanticString">，就像 UDP 一样。但是其可以</span><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="https://rfc.zeromq.org/spec/15/">用标志位对消息进行扩展</a></span><span class="SemanticString">，也就是说，实际使用上，一个zmq消息可以由多个帧组成。</span></span><div id="https://www.notion.so/63a8482654584ed6a09fa6c0632c5607" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Originally, a ZeroMQ message was one frame, like UDP. We later extended this with multipart messages, which are quite simply series of frames with a “more” bit set to one, followed by one with that bit set to zero. The ZeroMQ API then lets you write messages with a “more” flag and when you read messages, it lets you check if there’s “more”.</span></span></p></div><ul class="BulletedListWrapper"><li id="https://www.notion.so/fd077ff311dd4f39b1b140f58c9c92ea" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">A message can be one or more parts.</span></span></li><li id="https://www.notion.so/f792ca537dfc40349a954ab51215cd9e" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">These parts are also called “frames”.</span></span></li><li id="https://www.notion.so/24bba226afb843b1944b7cbccf638b8d" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Each part is a object </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">zmq_msg_t</code></span></span></li><li id="https://www.notion.so/935bc9beeba34db9a40573cbcf477e4b" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">You send and receive each part separately, in the low-level API.</span></span></li><li id="https://www.notion.so/713ec2a7082445359c0e18acb56e5f3f" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Higher-level APIs provide wrappers to send entire multipart messages.</span></span></li></ul></li><li id="https://www.notion.so/c8081a4186b74fbf8b5496dd5d0ea994" class="NumberedList" value="3"><span class="SemanticStringArray"><span class="SemanticString">msg 的一些注意事项</span></span><ul class="BulletedListWrapper"><li id="https://www.notion.so/06e640dc561f4117bdde07c811de6883" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">可以发送0长度的msg作为信号</span></span><div id="https://www.notion.so/443d29ebe467404bba0b2ef7061a4534" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">You may send zero-length messages, e.g., for sending a signal from one thread to another.</span></span></p></div></li><li id="https://www.notion.so/d0c076105bf14374abb74218b6151f83" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">保证消息传递的原子性</span></span><div id="https://www.notion.so/abc7be070fee4899b932fff886a7008d" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">ZeroMQ guarantees to deliver all the parts (one or more) for a message, or none of them.</span></span></p></div></li><li id="https://www.notion.so/17b8b99fdec145939e157a9a861477d4" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">异步发送，要保证内存中的队列不会爆</span></span><div id="https://www.notion.so/32ecdcdfcb464acc87b2839e407644d6" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">ZeroMQ does not send the message (single or multipart) right away,
but at some indeterminate later time. A multipart message must therefore fit in memory.</span></span></p></div></li><li id="https://www.notion.so/6cabb5cfae104c04821f753f6a52c831" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">大文件的发送需要自己手动拆分，多次发送</span></span><div id="https://www.notion.so/22fdb2bda9a743f79eaee6bf06d95b94" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">A message (single or multipart) must fit in memory. If you want to
send files of arbitrary sizes, you should break them into pieces and
send each piece as separate single-part messages. </span><span class="SemanticString"><em class="SemanticString__Fragment SemanticString__Fragment--Italic">Using multipart data will not reduce memory consumption.</em></span></span></p></div></li><li id="https://www.notion.so/e97f942b345943aebe1ff0f4f5b9f32c" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">You must call </span><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="http://api.zeromq.org/master:zmq_msg_close">zmq_msg_close()</a></span><span class="SemanticString"> when finished with a received message, in languages that don’t automatically destroy objects when a scope closes. You don’t call this method after sending a message.</span></span></li><li id="https://www.notion.so/3c2635bbde634c839d449f1344d7d49e" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="http://api.zeromq.org/master:zmq_msg_init_data">zmq_msg_init_data()</a></span><span class="SemanticString"> 是一种 zero-copy 的方法，需要谨慎使用</span></span></li></ul></li></ol><h3 id="https://www.notion.so/2610f7c064f8494085a37d0ccffe1d87" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/2610f7c064f8494085a37d0ccffe1d87"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">同步 PUB-SUB，捕获第一条消息</span></span></h3><details id="https://www.notion.so/567cd15bf79f4524a76fb1fe8f723982" class="ColorfulBlock ColorfulBlock--ColorDefault Toggle "><summary class="Toggle__Summary"><span class="SemanticStringArray"><span class="SemanticString">The </span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">subscriber</strong></span><span class="SemanticString"> will always miss the first messages that the </span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">publisher</strong></span><span class="SemanticString"> sends.</span></span></summary><div class="Toggle__Content"><div id="https://www.notion.so/d61421fc08244aeb9c17cfa0f6c3274c" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">This is because as the subscriber connects to the publisher (something that takes a small but non-zero time), the publisher may already be sending messages out.</span></span></p></div><blockquote id="https://www.notion.so/fd254158b9394a7b9efd6b2db1b944da" class="ColorfulBlock ColorfulBlock--ColorDefault Quote"><span class="SemanticStringArray"><span class="SemanticString">Making a TCP connection involves to and from handshaking that takes several milliseconds depending on your network and the number of hops between peers. In that time, ZeroMQ can send many messages. For sake of argument assume it takes 5 msecs to establish a connection, and that same link can handle 1M messages per second. During the 5 msecs that the subscriber is connecting to the publisher, it takes the publisher only 1 msec to send out those 1K messages.</span></span></blockquote></div></details><div id="https://www.notion.so/5f06c7402ba3419f86512a78c782e5fb" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="https://zguide.zeromq.org/docs/chapter2/#Node-Coordination">https://zguide.zeromq.org/docs/chapter2/#Node-Coordination</a></span></span></p></div><h3 id="https://www.notion.so/c94f039f7c064a1887a9d572f69e8017" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/c94f039f7c064a1887a9d572f69e8017"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">解读 ROUTER-ROUTER</span></span></h3><div id="https://www.notion.so/cb9f84bcdceb4d2f8f260182c7e30830" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">zmq 的基础使用中，不应该存在 ROUTER-ROUTER 的双端通信。（虽然 ROUTER-ROUTER 是合法的组合）ROUTER-ROUTER 的强行通信（不交换IDENTITY）会导致tcp握手一直被rst。</span></span></p></div><ul class="BulletedListWrapper"><li id="https://www.notion.so/72a4d720d90b4e199781879a150e6c56" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString"><del class="SemanticString__Fragment SemanticString__Fragment--Strike">在 tdserver 中，DEALER 被封装在了 wrapper 文件定义的对象中，后来又被隐晦地调用了，所以给人一种 ROUTER-ROUTER 通信的错觉</del></span></span></li><li id="https://www.notion.so/6aef9655b4954f95a27bd770d2843762" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">本质上是，DEALER 通信时，会隐式地在序列开头添加自己随机的一个 IDENTITY，这个 IDENTITY 会让 ROUTER 在内部维护一个映射关系，即 IDENTITY-&gt;DEALER 的映射，如此来把返回的结果正确的发送给对应的 DEALER ，而在封装的实现中，ROUTER 是不会主动添加 IDENTITY 的（其本身也没有初始化的 IDENTITY）</span></span></li><li id="https://www.notion.so/4741ebec486f408a8099a3a76b674a36" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">下面说的 DEALER 代指具有 IDENTITY 的 zmq.Socket，使用 DEALER 是为了便于理解</strong></span></span></li><li id="https://www.notion.so/2c5a783d19474567bd83e026eb4ef120" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">想要实现 ROUTER-ROUTER 的通信，就需要将 ROUTER 伪装成 DEALER</span></span></li><li id="https://www.notion.so/40854e97cb1142479546c04a24dd8318" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">先从发送讲起，ROUTER A 现在要向另一个 ROUTER B 发送信息，在 A 的眼中，B 是一个 DEALER，所以 A 需要手动添加一个 IDENTITY 在序列的开头，而这个 IDENTITY 必须和 B 的 IDENTITY 完全一样！</span></span></li><li id="https://www.notion.so/752291590c2d484285361a0a40649f5d" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">接收是正常的流程</span></span></li><li id="https://www.notion.so/82e9c6e9da2144ce850acdb05ba25e36" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">发现了吗，在 ROUTER-ROUTER 模型中，他们之间想要实现双端通信，就必须要知道对方的 IDENTITY，但是一般情况下，想要知道对方的 IDENTITY，就要实现双端通信。。。</span></span></li><li id="https://www.notion.so/a98cf10aa79d44a493169d87ce6e7886" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">非常经典的悖论，</span><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="https://zguide.zeromq.org/docs/chapter4/#reliable-request-reply">官方文档</a></span><span class="SemanticString">中也对这个问题进行了简要的讨论，给出了一些解决方案，但是根据 KISS 原则，如此模型是不应该存在于任何一种设计中的</span></span></li></ul><h3 id="https://www.notion.so/d8c285af2acb449885fc1504383d37b8" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/d8c285af2acb449885fc1504383d37b8"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">为什么是zmq_poll()而不是zmq_epoll()？</span></span></h3><div id="https://www.notion.so/123f05f20ff3467badf03600b61c76c9" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="https://github.com/zeromq/libzmq/issues/1667">https://github.com/zeromq/libzmq/issues/1667</a></span></span></p></div><h3 id="https://www.notion.so/844a02161d174e1bbefc6fb4cd220fb3" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/844a02161d174e1bbefc6fb4cd220fb3"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">zmq_proxy()里的配对瞎配会怎么样？</span></span></h3><blockquote id="https://www.notion.so/21fa459dd4854e2b922a38d2ff79d6d8" class="ColorfulBlock ColorfulBlock--ColorDefault Quote"><span class="SemanticStringArray"><span class="SemanticString">If you’re like most ZeroMQ users, at this stage your mind is starting to think, “What kind of evil stuff can I do if I plug random socket types into the proxy?” The short answer is: try it and work out what is happening. In practice, you would usually stick to ROUTER/DEALER, XSUB/XPUB, or PULL/PUSH.</span></span></blockquote><div id="https://www.notion.so/4a105a53572e4cac9c6be7c6132b57db" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">经过wireshark抓包发现，对于接收信息来说瞎配啥事也没有，能收到。但是一旦proxy的组合不符合配对规律，frontend 到 backend 的通信会连包都发不出去，也就是在函数内部进行了阻断。</span></span></p></div><h3 id="https://www.notion.so/3c5c8bd8844248f3bbb4d2cbbf632f21" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/3c5c8bd8844248f3bbb4d2cbbf632f21"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">zmq 错误处理之道</span></span></h3><div id="https://www.notion.so/cec3998ac4b2482384a633d4eb4f9f7e" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="https://zguide.zeromq.org/docs/chapter2/#Handling-Errors-and-ETERM">https://zguide.zeromq.org/docs/chapter2/#Handling-Errors-and-ETERM</a></span></span></p></div><h3 id="https://www.notion.so/d8d4fb17af88407ebb573950e8095d81" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/d8d4fb17af88407ebb573950e8095d81"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">zmq之信息丢失</span></span></h3><div id="https://www.notion.so/75a4d41706104889b929f8e67265e43f" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="https://zguide.zeromq.org/docs/chapter2/#Missing-Message-Problem-Solver">https://zguide.zeromq.org/docs/chapter2/#Missing-Message-Problem-Solver</a></span></span></p></div></article>
  <footer class="Footer">
  <div>&copy; humblog 2022</div>
  <div>&centerdot;</div>
  <div>Powered by <a href="https://github.com/dragonman225/notablog" target="_blank"
      rel="noopener noreferrer">Notablog</a>.
  </div>
</footer>
</body>

</html>